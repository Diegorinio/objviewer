@using System.IO;
@using System.Web;
@{
    ViewData["Title"] = "Model Viewer";
    string[] filesPath = Directory.GetFiles("wwwroot/assets/");
}
<div class="viewer">
    @{
        foreach (string file in filesPath)
        {
            string fileName = file.Replace("wwwroot/assets/", "");
            <div class="file-icon" onclick="renderIcon(this, '@file')">@fileName
                <a class="file-preview-btn" asp-action="ModelPreview" asp-route-objectname="@fileName">Zobacz</a>
    </div>
        }
    }
</div>
<script>
    renderIcon = (target, filedir) => {
            if(document.querySelectorAll(".icon-canvas").length > 0)
            {
                document.querySelectorAll(".icon-canvas").forEach(el =>{
                    el.remove();
                })
            }
        filedir = filedir.replace("wwwroot", "");
        console.log(filedir);
        let canvas = document.createElement("canvas");
        canvas.className = "icon-canvas";
        canvas.setAttribute("width", "100px");
        canvas.setAttribute("height", "100px");
        target.appendChild(canvas);
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(90, 1, 1, 100);
        camera.updateProjectionMatrix();
        var Loader = new THREE.OBJLoader();
        var light = new THREE.AmbientLight(0x404040);
        scene.add(light);
        scene.background = new THREE.Color('black');
        var render = new THREE.WebGLRenderer({canvas: canvas});
        render.setSize(canvas.width, canvas.height);
        Loader.load(filedir, (object)=>{
            scene.add(object);
            object.position.set(0,0,0);
            object.rotation.set(15,10,0);
            camera.position.z = 4;
            render.render(scene, camera);
        })
    }
</script>